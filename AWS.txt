2019.12.05

When we crate VPC
		route table
		Network ACL  
		Security Group will create default
		
		screenshot
		
when we create subnet it will not default assign public ip address

Only one Internet gateway can assign to the per VPC



When we create the subnet it default assign to Main route table(default one automaticlly create with creation of VPC) of the VPC
so better we create public route table for public accessible route


public route table out traffic(0.0.0.0/0) set target to internet gateway 
so that route table associate with any subnet then it has internet access

When create the EC2 if its in public facing subnet then public ip address will automatically assigned
When create the EC2 instance that security group(that created with VPC creation) only visible,

Exam tips
When you create a VPC default Route Table, Network Access Control list(NACL) and a default Security Group 
It won't create any subnets, nor will it create a default internet gateway
US-East-1A in your AWS account can be a completely different availability zone to US-East-1A in another AWS account. The AZ's are randomized
Amazon always reserve 5 IP addresses within your subnets
You can only have 1 Internet Gateway per VPC
Security Groups can't span VPCs




To access the private subnet EC2 have to assign to new security group since with the default security groups dose not allow to ping or SSH to the instance
When allowing access from security group you can set source to only internal ip address within VPC
screenshot
 
to access the private subnte ec2 you have to save privet.pem private key in public subnet EC2 instance then you can ssh to private subnet EC2 from there
but its not secure since you save your private key in publically faced machine. so better way is use bastion hosts


Nat Instanes and Nat gateways

screenshot

Nat instances individual ec2 instance to do the internet access.
Nat Gateway is highly available gateway


Nat Instances
to create nat instance you have to create nat ec2 instance(have to select nat instance when creating its commercial)
to this ec2 instance to be a nat instance has to desaible source and destination check

to go out to the internet then private subnets route table out traffic (0.0.0.0/0) has to set to nat instance





Nat Gateway
to go out to the internet then private subnets route table out traffic (0.0.0.0/0) has to set to nat gateway


Exam tips

Nat Instances Exam  tips

When creating a NAT instance, Desable Source/Destination Check on the instance.
NAT instance must be in a public subnet
There must be a route out of the private subnet to the NAT isntcance, in order for this to work
The amount of traffic that NAT instances can support depends on the instance size. If you bottlenecking,increase the instance size.
YOu can create high availablity using Ausoscaling Groups, muliple subnets in different AZs, and a script to automate failover.
Behind a Security Group

Nat Gateways
 Redundant inside the Availability Zone(not single EC2 instance)
 One Nat gatewaork in one AZ
 Preferred by the enterprise
 Starts at 5Gbps and scalses curreltly to 45Gbps
 No need to patch
 Not associated with security groups
 Automatically assigned a public ip address
 Remember to update your route tables for nat gateway
 
 
If you have resources in multiple Availability Zones and they share one NAT gateway, in the event that the NAT gateway's Availability Zone is down,
resources in the other Availability Zones lose internet access. To create an Availability Zone-independent architecture, create a NAT gateway in each Availabiity Zone
and configure your routing to ensure that resources use the NAT gateway in the same Availability Zone.



ACL(Access Control List)

screenshot


have allow rules and deney rules
When create new ACL its defulty deny everyting (inbound and outbound)
When you create ACL you have to select the VPC then you can associate subnets with that ACL
so VPC can have more than one ACLs

rules execuring order to the rule number
between rule numbers better give 100 spaces so later can add other rules in between. 
Deny rules have to define before allow(for example if you add deny rule after allowing 0.0.0.0/0 then it won't work)
(simply if you allow before deny it won't work)

When you create VPC it will create ACL automatically and subnets you create in that VPC automatically assigned to that ACL
if you need to change the ACL you can create a ACL by your own and subnet can assign to that ACL
Subnet only can assoiate with one Network ACL by the time
ACL can assosiate with many subnets
ACL rules change will affect imediately



Exam tips

Your VPC automatically comes with a default network ACL, and by default it allows all outbound and inbound traffic
You can create custom network ACLs. By default, each custom network ACL denies all inbound and outbound traffic untill add rules
Each subnet in your VPC must associated with a network ACL. If you dont explicilty associate a subnet with a network ACL, the subnet automatically associated with the default network ACL
Block IP Addresses using ACLs not Security Groups
You can associate a network ACL with multiple subnets, however a subnet can be associate with only one network ACL at a time. When you associate a network ACL with a subnet, the previous
association is removed
Network ACLs contain anumberd list of rules that is evalueated in order, starting with the lowerst numberd rule
Network ACLs have seperate inbound and outbound rules, and each rule can either allow or deny traffic.
Network ACLs are stateless responses to allowed inbound traffic sre subject to the rules for outbound traffice(and vice versa)



















2019.12.06

Custom VPCs and ELBs

At least two subnet need to create load balancer


VPC Flow Logs

VPC Flow Logs is a feature that enables you to capture information about the IP traffic going to and from network interfaces in you VPC.
Flow log data is stored using Amazon CloudWatch Logs. After you've created a flow log, you can view and retrieve its data in Amazon CloudWatch Logs

Flow logs can be created at 3 levels
	VPC
	Subnet
	Network Interface Level
	
Exam Tips

You cannot enable flow logs for VPCs that are peered peered with you VPC unless the peer VPC is in your account
You cannot tag a flow log
After you've created a flow log, you cannot change its configuration, for example you can't associate a different IAM role with the flow log

Not all IP traffic is monitored
	Traffic generated by instances when they contact the Amazon DNS server. If you use your own DNS sever, then all traffic to that DNS sever is logged
	Traffic generated by a Windows instance for Amazon Windows license activation
	Traffic to and from 169.254.169.254 for instance metadata
	DHCP traffic
	Traffic to the reserved IP address for the default VPC router



	
Bastion Hosts

A bastion host is a special purpose computer on a network specifically designed and configured to withstand attacks.
The computer generally hosts a single application, for example proxy server, and all other services are removed or limited
to reduce the threat to the computer. It is hardened in this manner primarily due to its location and purpose, which is either on the outside of a firewall or in a
demilitarized zone(DMZ) and usually involves access from untrusted networks or computes.

screenshot

Exam tips
A NAT Gateway or NAT instance is used to provide internet traffic to EC2 instances in a private subnets
A Bastion is used to securely administer EC2 instances (Using SSH or RDP) Bastions are called Jump Boxes in Australia
You cannot use a NAT Gateway as a Bastion host


Direct Connect

AWS Direct Connect is a cloud service solution that makes it easy to establish a dedicated network connection from your premises to AWS.
Using AWS Direct Connect, you can establish private connectivity between AWS and your data-centre, office, or co-location environment, which in many cases can reduce
your network costs, increase bandwidth throughput, and provide a more consistent network experience than internet-based connection.

sceenshot

Exam tips
	Direct Connect directly connects your data centre to AWS
	Usefull for high throughput workloads (ie lots of network traffic)
	Or if you need a stable and reliable secure connection
	
	
VPC Endpoints

What is a VPC Endpoint
A VPC endpoint enable you to privately connect your VPC to supported AWS services and VPC endpoint services powered by Private Link without requiring an internet gateway,
NAT device, VPN connection, or AWS Direct Connect connection. Instances in you VPC do not require public IP address to communicate with resources in the service. Traffic
between you VPC and the other service dose not leave the Amazon network

Endpoints are virtual devices. They are horizontally scaled, redundant, and highly available VPC components that allow communication between instances in your VPC and services without
imposing availability risks or bandwidth constraints on your network traffic.

 Exam tips
 
 There are two types of VPC endpoints
	Interface Endpoints
	Gateway Endpoints
	
	
An interface endpoint is an elastic network interface with a private IP address that serves as an entry point for traffic destined to a supported services. 
Ex SNS, SQS, API Gateway etc

Currently Gateway Endpoints Support
	Amazon S3
	DynamoDB
	
screen shot	2 (using internet and using VPC gateway)
	

	
	
	
	

	
Load balancers
	
	
	
Classic load balancers
are the legacy Elastic load balancers.
You can load balance HTTP/HTTPS applications and use Layer 7specific features, such as X-Forworded and sticky sessions. You can also use strict Layer 4 load balancing for 
applications that rely purely on TCP protocol.

Classic load balancers just check intances are helthy with helth checks and simply route traffic to the instances primary manner like one to instance one and second request to 
instance two
Application load balancers you can give advance routing with using if else conditions 


if you applicaiton stops responging, the ELB(Classic Load Balancer) responds with a 504 error 
this means that the application is having issues. This could be either at the Web Server layer or at the Database Layer.
Indentify where the applicaion is failing, and scale it up or out where possible.


X-FOrworded-For Header
load balncer send traffic with there ip address so to get clinet ip address you can check X-Forworded header
If you need the IPv4 address of your end user, look for the X-Forworded-For header
Secreenshot



Load Balancers and helth checks


Exam tips

3 Deferent types of load balances

Applciation load balancers
netowrk load balncers
classicl load balancers

504 Error means the gateway has timeout. This means that the applications not responding whithin the idle timeout period
Trouble shoot the application. Is it the web server or Database server

If you need the IPv4 address of your end user, look for the X-Forworded-For header


Instanaces  monitored by ELB are reported as InService or OutofSErvice
Health Checks checks the instance health by talking to it

Load Balancers have their own DNS name. You are never given an IP address.





Advanced Load Balancer Theory

What Are Sticky Sessions

Classic Load Balancer routes each request independently to the registerd EC2 instance with the smalled load.
Sickey session allow you to bind a user;s session to a specific EC2 instance. This ensure that all request from the user during the session are sent to the same instance

You can enable sticky sessions for application load balancers as well, but the traffice will be sent at the Target Group level

screenshot


What is Cross Zone Load Balancing

No Cross Zone Load Balanceing
screenshot

with cross zone load balancing

screesnshot
common exam senario screenshot


What are path patterns

You can create a listener with rules to forword requests based on the URL path. This is known as path-based routing. If you are running microservices, you can route traffic to multiple
back-end services using path-based routing. For example, you can route general requests to one target group and requests to render images to another target group.

common exam senario screenshot

Exam tips
Advance Load Balancer theory
Sticky Sessions enable your users to stick to the same EC2 instance. Can be usefull if you are storing information locally to that instance.
Cross Zone Lad balancing enables you to load balance across multiple availability zones
Path patterns allow you to direct traffic to diferent EC2 instances based on the  URL contained in the request.


Launch Configurations and Auto Scaling Groups

To create Auto Scaling Group you first have to create Launch Configuration
After that you can use that launch configuration to create auto scaling group

What happens with auto scaling group. you can define metrix (like CPU more than 80% ) to create new EC2 instance.
You can define minimum and maximum number of EC2 instances run with auto scaling group and desired instance of running
if you have set up desired instance count as 3 then if 2 goes down another two instances will create by the Auto Scaling Groups






















	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	








































	











 















	











 



